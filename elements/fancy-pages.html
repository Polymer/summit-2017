<!--
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymer/lib/utils/import-href.html">

<dom-module id="fancy-pages">

  <template>
    <style>
      :host > ::slotted(*) {
        display: none;
        transform: translate3d(0, 50vh, 0);
        opacity: 0;
        transition-property: transform, opacity;
        transition-duration: 0.5s;
        will-change: transform, opacity;
      }

      :host > ::slotted(.active) {
        display: block;
        transform: translate3d(0, 0, 0);
        opacity: 1;
      }
    </style>

    <slot id="slot"></slot>
  </template>

  <script>

    class FancyPagesElement extends Polymer.Element {

      static get is() { return 'fancy-pages' }

      static get properties() {
        return {
          path: {
            type: String,
            observer: '_pathChanged'
          }
        }
      }

      _pathChanged(path, oldPath) {
        if (!this.isConnected) return;

        this._oldSelected = this._findChildWithPath(oldPath);
        this._selected = this._findChildWithPath(path);

        if (this._selected) {
          Polymer.importHref(`/elements/${this._selected.localName}.html`);
        }

        if (this._oldSelected) {
          this._oldSelected.style.display = 'block';
          this._oldSelected.classList.remove('active');
          window.setTimeout(() => {
            this._oldSelected.style.display = '';
            this._transitionIn();
          }, 500);
        } else {
          this._transitionIn();
        }
      }

      _findChildWithPath(path) {
        const children = this.$.slot.assignedNodes();
        for (let i = 0; i < children.length; ++i) {
          const child = children[i];
          if (child.nodeType === Node.ELEMENT_NODE && child.getAttribute('path') === path) {
            return child;
          }
        }
        return null;
      }

      _transitionIn() {
        if (this._selected) {
          window.scrollTo(0, 0);
          this._selected.style.display = 'block';
          requestAnimationFrame(() => {
            setTimeout(() => {
              this._selected.style.display = '';
              this._selected.classList.add('active');
            });
          });
        }
      }

    }

    customElements.define(FancyPagesElement.is, FancyPagesElement);

  </script>
</dom-module>
