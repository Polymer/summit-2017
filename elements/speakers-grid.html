<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymer/lib/elements/dom-repeat.html">

<link rel="import" href="grid-view.html">
<link rel="import" href="collapsible-card.html">

<dom-module id="speakers-grid">
  <template>
    <style>
      a {
        text-decoration: none;
        font-size: inherit;
        color: inherit;
      }

      .photo-wrap {
        position: relative;
        padding-bottom: 75%; /* 4x3 */
        background-color: #eaeaea;
        overflow: hidden;
      }

      .photo {
        position: absolute;
        top: -20px;
        left: 0;
        width: 100%;
        height: auto;
      }

      .card {
        background-color: #fff;
        /*-webkit-transform: translateZ(0);
        will-change: transform;*/
      }

      .content {
        position: relative;
        padding: 16px;
      }

      .name, .title {
        line-height: 30px;
      }

      .name {
        font-weight: 600;
        color: #147BCC;
      }

      .title {
        color: #4FB6F7;
        font-style: italic;
        opacity: 0.8;
      }

      [collapsible-content] {
        padding: 16px 16px 72px;
      }

      .bio {
        font-size: 16px;
      }

      .bottom-tools {
        position: absolute;
        bottom: 16px;
        margin-left: -8px;
      }

      .bottom-tools > * {
        padding: 8px;
      }

      .icon {
        width: 24px;
        height: 24px;
      }

      .toggle-icon {
        display: none;
      }

      [hidden] {
        display: none;
      }

      @media (max-width: 643px) {
        .card {
          box-shadow: none;
          border-bottom: 1px solid #ddd;
        }

        [collapsible-content] {
          padding: 16px;
        }

        .bottom-tools {
          position: static;
          margin: 24px 0 24px -8px;
        }

        .toggle-icon {
          display: inline-block;
          position: absolute;
          right: 8px;
          bottom: 4px;
          width: 40px;
          height: 40px;
          padding: 8px;
          fill: #4FB6F7;
          cursor: pointer;
        }

        .card.opened .toggle-icon {
          -webkit-transform: rotate(180deg);
          transform: rotate(180deg);
        }
      }
    </style>

    <grid-view>
      <dom-repeat items="[[data]]">
        <template>

          <collapsible-card class="card">
            <div class="photo-wrap">
              <img class="photo" src="[[item.photo]]" aria-hidden="true">
            </div>

            <div class="content">
              <div class="name">[[item.name]]</div>
              <div class="title">[[item.title]]</div>
              <svg class="icon toggle-icon" viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet"><g><path d="M7 10l5 5 5-5z"></path></g></svg>
            </div>

            <div collapsible-content="">
              <div class="bio">[[item.bio]]</div>
              <div class="bottom-tools">
                <a href="[[_gplusUrl(item.gplus)]]" target="_blank" rel="noopener" data-outbound hidden$="[[!item.gplus]]" aria-label="Follow on G Plus">
                  <svg class="icon" viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet"><g><path fill="none" d="M0 0h24v24H0V0z"></path><path d="M23 11h-2V9h-2v2h-2v2h2v2h2v-2h2zM8 11v2.4h3.97c-.16 1.03-1.2 3.02-3.97 3.02-2.39 0-4.34-1.98-4.34-4.42S5.61 7.58 8 7.58c1.36 0 2.27.58 2.79 1.08l1.9-1.83C11.47 5.69 9.89 5 8 5c-3.87 0-7 3.13-7 7s3.13 7 7 7c4.04 0 6.72-2.84 6.72-6.84 0-.46-.05-.81-.11-1.16H8z"></path><path fill="none" d="M1 5h14v14H1z"></path></g></svg>
                </a>
                <a href="[[_twitterUrl(item.twitter)]]" target="_blank" rel="noopener" data-outbound hidden$="[[!item.twitter]]" aria-label="Follow on Twitter">
                  <svg class="icon" viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet"><g><path d="M20 2h-16c-1.1 0-1.99.9-1.99 2l-.01 16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-16c0-1.1-.9-2-2-2zm-2.29 7.33c-.06 4.62-3.02 7.78-7.42 7.98-1.82.08-3.14-.5-4.28-1.23 1.34.21 3.01-.32 3.9-1.09-1.32-.13-2.1-.8-2.46-1.88.38.07.78.05 1.14-.03-1.19-.4-2.04-1.13-2.08-2.67.33.15.68.29 1.14.32-.9-.5-1.55-2.35-.8-3.57 1.32 1.45 2.91 2.63 5.52 2.79-.65-2.8 3.06-4.32 4.61-2.44.66-.13 1.19-.38 1.7-.65-.21.65-.62 1.1-1.12 1.47.54-.07 1.03-.21 1.44-.41-.25.53-.81 1.01-1.29 1.41z"></path></g></svg>
                </a>
              </div>
            </div>
          </collapsible-card>

        </template>
      </dom-repeat>
    </grid-view>
  </template>

  <script>

    class SpeakersGridElement extends Polymer.Element {

      static get is() { return 'speakers-grid' }

      ready() {
        super.ready();

        const xhr = new XMLHttpRequest();
        xhr.addEventListener('load', () => {
          this.data = xhr.response;
        });
        xhr.open('GET', '/data/speakers.json');
        xhr.responseType = 'json';
        xhr.send();
      }

      _gplusUrl(name) {
        return 'https://plus.google.com/' + name;
      }

      _twitterUrl(name) {
        return 'https://twitter.com/' + name;
      }

    }

    customElements.define(SpeakersGridElement.is, SpeakersGridElement);

  </script>
</dom-module>
